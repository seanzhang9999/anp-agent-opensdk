<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANP Open SDK 重构计划</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
            margin-top: 30px;
        }
        .phase {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .phase-1 { border-left-color: #3498db; }
        .phase-2 { border-left-color: #2ecc71; }
        .phase-3 { border-left-color: #f39c12; }
        .phase-4 { border-left-color: #e74c3c; }
        
        .task {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .priority {
            padding: 3px 10px;
            border-radius: 3px;
            color: white;
            font-size: 12px;
        }
        .priority-high { background-color: #e74c3c; }
        .priority-medium { background-color: #f39c12; }
        .priority-low { background-color: #27ae60; }
        
        .file-list {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 3px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 13px;
        }
        .summary-box {
            background-color: #e8f4f8;
            border: 1px solid #b8e0e8;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #e74c3c;
            color: white;
        }
        .timeline {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }
        .timeline::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #ddd;
            z-index: -1;
        }
        .timeline-item {
            text-align: center;
            flex: 1;
        }
        .timeline-dot {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ANP Open SDK 重构计划</h1>
        
        <div class="summary-box">
            <h3>重构概要</h3>
            <p><strong>目标</strong>：基于新的架构设计，将现有代码重构为模块化、可扩展的系统</p>
            <p><strong>预计周期</strong>：4个阶段，约8-12周</p>
            <p><strong>影响范围</strong>：核心架构调整，保持API向后兼容</p>
        </div>

        <h2>重构时间线</h2>
        <div class="timeline">
            <div class="timeline-item">
                <div class="timeline-dot">P1</div>
                <div>基础架构</div>
                <div>2周</div>
            </div>
            <div class="timeline-item">
                <div class="timeline-dot" style="background-color: #2ecc71;">P2</div>
                <div>协议层</div>
                <div>3周</div>
            </div>
            <div class="timeline-item">
                <div class="timeline-dot" style="background-color: #f39c12;">P3</div>
                <div>传输路由</div>
                <div>2周</div>
            </div>
            <div class="timeline-item">
                <div class="timeline-dot" style="background-color: #e74c3c;">P4</div>
                <div>优化集成</div>
                <div>2周</div>
            </div>
        </div>

        <h2>阶段详情</h2>

        <div class="phase phase-1">
            <h3>第一阶段：基础架构重构（2周）</h3>
            
            <div class="task">
                <div class="task-header">
                    <h4>1.1 目录结构调整</h4>
                    <span class="priority priority-high">高优先级</span>
                </div>
                <p>将现有代码按新架构重新组织</p>
                <div class="file-list">
anp_open_sdk/
├── core/
│   ├── profiles.py         # 新增：场景配置
│   ├── builder.py          # 新增：Agent构建器
│   └── exceptions.py       # 整理异常类
├── agent/
│   ├── protocols/          # 新增：协议层
│   │   ├── base.py
│   │   ├── agent_protocol.py
│   │   └── context_protocol.py
│   └── local.py           # 重构：整合现有Agent逻辑
├── networking/
│   ├── transport_router.py # 重构：从accelerator改名
│   └── transport_manager.py # 新增：传输管理
└── storage/
    └── secure.py           # 新增：安全存储
                </div>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>1.2 创建基础接口和抽象类</h4>
                    <span class="priority priority-high">高优先级</span>
                </div>
                <p>定义核心抽象类，为后续实现打基础</p>
                <ul>
                    <li>BaseProtocol - 协议基类</li>
                    <li>TransportAdapter - 传输适配器基类</li>
                    <li>SecureStorageProvider - 安全存储基类</li>
                    <li>ProfileConfig - 场景配置类</li>
                </ul>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>1.3 实现场景自适应系统</h4>
                    <span class="priority priority-medium">中优先级</span>
                </div>
                <p>实现AgentBuilder和create_agent接口</p>
                <ul>
                    <li>定义DeploymentMode枚举</li>
                    <li>实现ProfileManager</li>
                    <li>创建统一的初始化接口</li>
                </ul>
            </div>
        </div>

        <div class="phase phase-2">
            <h3>第二阶段：协议层实现（3周）</h3>
            
            <div class="task">
                <div class="task-header">
                    <h4>2.1 ANP协议适配器</h4>
                    <span class="priority priority-high">高优先级</span>
                </div>
                <p>实现原生ANP协议支持</p>
                <div class="file-list">
agent/protocols/implementations/
├── anp_agent.py    # ANP Agent协议实现
└── anp_discovery.py # ANP发现协议
                </div>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>2.2 MCP协议适配器</h4>
                    <span class="priority priority-medium">中优先级</span>
                </div>
                <p>实现MCP工具协议支持</p>
                <div class="file-list">
agent/protocols/implementations/
├── mcp_context.py   # MCP上下文协议
├── mcp_bridge.py    # MCP桥接器
└── mcp_transport.py # MCP传输适配
                </div>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>2.3 A2A协议适配器</h4>
                    <span class="priority priority-low">低优先级</span>
                </div>
                <p>实现A2A任务协议支持</p>
                <ul>
                    <li>任务定义和转换</li>
                    <li>双向发布机制</li>
                    <li>任务处理器注册</li>
                </ul>
            </div>
        </div>

        <div class="phase phase-3">
            <h3>第三阶段：传输路由层（2周）</h3>
            
            <div class="task">
                <div class="task-header">
                    <h4>3.1 重构LocalAgentAccelerator</h4>
                    <span class="priority priority-high">高优先级</span>
                </div>
                <p>将加速器重构为TransportRouter</p>
                <ul>
                    <li>分离路由决策和传输执行</li>
                    <li>实现智能路由算法</li>
                    <li>添加路由缓存和统计</li>
                </ul>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>3.2 实现传输适配器</h4>
                    <span class="priority priority-medium">中优先级</span>
                </div>
                <p>实现各种传输协议适配器</p>
                <div class="file-list">
networking/adapters/
├── local_adapter.py     # 本地内存传输
├── http_adapter.py      # HTTP/REST传输
├── websocket_adapter.py # WebSocket传输
└── grpc_adapter.py      # gRPC传输（可选）
                </div>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>3.3 传输管理器集成</h4>
                    <span class="priority priority-medium">中优先级</span>
                </div>
                <p>集成所有传输组件</p>
                <ul>
                    <li>统一的请求分发</li>
                    <li>故障转移机制</li>
                    <li>性能监控集成</li>
                </ul>
            </div>
        </div>

        <div class="phase phase-4">
            <h3>第四阶段：优化与集成（2周）</h3>
            
            <div class="task">
                <div class="task-header">
                    <h4>4.1 安全存储实现</h4>
                    <span class="priority priority-high">高优先级</span>
                </div>
                <p>实现基础的安全存储功能</p>
                <ul>
                    <li>PlainFileStorage - 开发用明文存储</li>
                    <li>EncryptedFileStorage - 生产用加密存储（框架）</li>
                    <li>与DID系统集成</li>
                </ul>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>4.2 测试与文档</h4>
                    <span class="priority priority-high">高优先级</span>
                </div>
                <p>完善测试用例和文档</p>
                <ul>
                    <li>单元测试覆盖核心功能</li>
                    <li>集成测试验证场景</li>
                    <li>更新API文档</li>
                    <li>编写迁移指南</li>
                </ul>
            </div>

            <div class="task">
                <div class="task-header">
                    <h4>4.3 性能优化</h4>
                    <span class="priority priority-low">低优先级</span>
                </div>
                <p>性能测试和优化</p>
                <ul>
                    <li>基准测试</li>
                    <li>瓶颈分析</li>
                    <li>缓存优化</li>
                    <li>并发优化</li>
                </ul>
            </div>
        </div>

        <h2>重构影响分析</h2>
        <table>
            <tr>
                <th>影响项</th>
                <th>变更类型</th>
                <th>兼容性</th>
                <th>迁移成本</th>
            </tr>
            <tr>
                <td>目录结构</td>
                <td>重大调整</td>
                <td>需要更新导入路径</td>
                <td>中等</td>
            </tr>
            <tr>
                <td>Agent初始化</td>
                <td>新增接口</td>
                <td>保持旧接口兼容</td>
                <td>低</td>
            </tr>
            <tr>
                <td>协议支持</td>
                <td>新增功能</td>
                <td>完全兼容</td>
                <td>无</td>
            </tr>
            <tr>
                <td>传输层</td>
                <td>内部重构</td>
                <td>对外透明</td>
                <td>无</td>
            </tr>
            <tr>
                <td>存储层</td>
                <td>新增功能</td>
                <td>可选启用</td>
                <td>低</td>
            </tr>
        </table>

        <h2>风险与缓解措施</h2>
        <div class="summary-box">
            <h4>主要风险</h4>
            <ul>
                <li><strong>兼容性风险</strong>：重构可能影响现有用户
                    <br>缓解：保持API向后兼容，提供详细迁移文档</li>
                <li><strong>复杂度风险</strong>：新架构增加了系统复杂度
                    <br>缓解：充分的文档和示例，渐进式迁移</li>
                <li><strong>性能风险</strong>：抽象层可能带来性能开销
                    <br>缓解：性能测试，关键路径优化</li>
                <li><strong>进度风险</strong>：重构工作量大
                    <br>缓解：分阶段实施，优先核心功能</li>
            </ul>
        </div>

        <h2>成功标准</h2>
        <ul>
            <li>✓ 所有现有测试用例通过</li>
            <li>✓ 新架构支持所有设计的场景</li>
            <li>✓ 性能不低于当前版本</li>
            <li>✓ 文档完整，示例清晰</li>
            <li>✓ 平滑的升级路径</li>
        </ul>

        <hr>
        <p style="text-align: center; color: #666;">
            ANP Open SDK 重构计划 v1.0<br>
            计划制定时间：2024年
        </p>
    </div>
</body>
</html>
